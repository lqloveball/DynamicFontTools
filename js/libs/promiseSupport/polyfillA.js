/**
 * http://g.alicdn.com/mtb/lib-promise/3.1.1/polyfillA.js
 *  支持Promise  规范A
 */
(function(){"use strict";function a(a){return"function"==typeof a||"object"==typeof a&&null!==a}function b(a){return"function"==typeof a}function c(a){return"object"==typeof a&&null!==a}function d(){}function e(){return function(){process.nextTick(i)}}function f(){var a=0,b=new L(i),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function g(){var a=new MessageChannel;return a.port1.onmessage=i,function(){a.port2.postMessage(0)}}function h(){return function(){setTimeout(i,1)}}function i(){for(var a=0;I>a;a+=2){var b=N[a],c=N[a+1];b(c),N[a]=void 0,N[a+1]=void 0}I=0}function j(){}function k(){return new TypeError("You cannot resolve a promise with itself")}function l(){return new TypeError("A promises callback cannot return that same promise.")}function m(a){try{return a.then}catch(b){return R.error=b,R}}function n(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function o(a,b,c){J(function(a){var d=!1,e=n(c,b,function(c){d||(d=!0,b!==c?r(a,c):t(a,c))},function(b){d||(d=!0,u(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,u(a,e))},a)}function p(a,b){b._state===P?t(a,b._result):a._state===Q?u(a,b._result):v(b,void 0,function(b){r(a,b)},function(b){u(a,b)})}function q(a,c){if(c.constructor===a.constructor)p(a,c);else{var d=m(c);d===R?u(a,R.error):void 0===d?t(a,c):b(d)?o(a,c,d):t(a,c)}}function r(b,c){b===c?u(b,k()):a(c)?q(b,c):t(b,c)}function s(a){a._onerror&&a._onerror(a._result),w(a)}function t(a,b){a._state===O&&(a._result=b,a._state=P,0===a._subscribers.length||J(w,a))}function u(a,b){a._state===O&&(a._state=Q,a._result=b,J(s,a))}function v(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+P]=c,e[f+Q]=d,0===f&&a._state&&J(w,a)}function w(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?z(c,d,e,f):e(f);a._subscribers.length=0}}function x(){this.error=null}function y(a,b){try{return a(b)}catch(c){return S.error=c,S}}function z(a,c,d,e){var f,g,h,i,j=b(d);if(j){if(f=y(d,e),f===S?(i=!0,g=f.error,f=null):h=!0,c===f)return void u(c,l())}else f=e,h=!0;c._state!==O||(j&&h?r(c,f):i?u(c,g):a===P?t(c,f):a===Q&&u(c,f))}function A(a,b){try{b(function(b){r(a,b)},function(b){u(a,b)})}catch(c){u(a,c)}}function B(a,b,c,d){this._instanceConstructor=a,this.promise=new a(j,d),this._abortOnReject=c,this._validateInput(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._init(),0===this.length?t(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&t(this.promise,this._result))):u(this.promise,this._validationError())}function C(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function D(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function E(a){this._id=Y++,this._state=void 0,this._result=void 0,this._subscribers=[],j!==a&&(b(a)||C(),this instanceof E||D(),A(this,a))}var F;F=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var G,H=F,I=(Date.now||function(){return(new Date).getTime()},Object.create||function(a){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof a)throw new TypeError("Argument must be an object");return d.prototype=a,new d},0),J=function(a,b){N[I]=a,N[I+1]=b,I+=2,2===I&&G()},K="undefined"!=typeof window?window:{},L=K.MutationObserver||K.WebKitMutationObserver,M="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,N=new Array(1e3);G="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?e():L?f():M?g():h();var O=void 0,P=1,Q=2,R=new x,S=new x;B.prototype._validateInput=function(a){return H(a)},B.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},B.prototype._init=function(){this._result=new Array(this.length)};var T=B;B.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===O&&a>d;d++)this._eachEntry(c[d],d)},B.prototype._eachEntry=function(a,b){var d=this._instanceConstructor;c(a)?a.constructor===d&&a._state!==O?(a._onerror=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(d.resolve(a),b):(this._remaining--,this._result[b]=this._makeResult(P,b,a))},B.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===O&&(this._remaining--,this._abortOnReject&&a===Q?u(d,c):this._result[b]=this._makeResult(a,b,c)),0===this._remaining&&t(d,this._result)},B.prototype._makeResult=function(a,b,c){return c},B.prototype._willSettleAt=function(a,b){var c=this;v(a,void 0,function(a){c._settledAt(P,b,a)},function(a){c._settledAt(Q,b,a)})};var U=function(a,b){return new T(this,a,!0,b).promise},V=function(a,b){function c(a){r(f,a)}function d(a){u(f,a)}var e=this,f=new e(j,b);if(!H(a))return u(f,new TypeError("You must pass an array to race.")),f;for(var g=a.length,h=0;f._state===O&&g>h;h++)v(e.resolve(a[h]),void 0,c,d);return f},W=function(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(j,b);return r(d,a),d},X=function(a,b){var c=this,d=new c(j,b);return u(d,a),d},Y=0,Z=E;E.all=U,E.race=V,E.resolve=W,E.reject=X,E.prototype={constructor:E,then:function(a,b){var c=this,d=c._state;if(d===P&&!a||d===Q&&!b)return this;var e=new this.constructor(j),f=c._result;if(d){var g=arguments[d-1];J(function(){z(d,e,g,f)})}else v(c,e,a,b);return e},"catch":function(a){return this.then(null,a)}};var $=function(){var a;a="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var c="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var c;return new a.Promise(function(a){c=a}),b(c)}();c||(a.Promise=Z)},_={Promise:Z,polyfill:$};"function"==typeof define&&define.amd?define(function(){return _}):"undefined"!=typeof module&&module.exports?module.exports=_:"undefined"!=typeof this&&(this.ES6Promise=_)}).call(this),function(){window.ES6Promise&&window.ES6Promise.polyfill()}();
